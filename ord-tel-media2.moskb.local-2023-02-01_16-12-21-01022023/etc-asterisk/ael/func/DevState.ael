// Set explicit state to device
macro DevState(Dev, State, fn) {
 catch h { // whitout a catch, dialplan stops execution on hangup !!!
  hang=1;
  Set(DEVICE_STATE(Custom:${Dev})=NOT_INUSE);
  return;
 }
 Set(DATA=${DATA},FUNC=${CONTEXT};Dev=${Dev});
 Set(CDR(x-data)={${DATA:1}});

 Set(DEVICE_STATE(Custom:${Dev})=${State});

 if ("${fn}"="") return;
 #include "ael/func/FUNC.INC"

 Set(DEVICE_STATE(Custom:${Dev})=NOT_INUSE);
 return;
}
